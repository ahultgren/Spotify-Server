<html>
<head>
	<title>Spotify Server</title>
</head>
<body>
<h1>Spotify Server</h1>

<p>Let the whole team choose what's played in the office speakers!</p>

<p id="player">
	Now <span id="state"></span> <span id="name"></span> by <span id="artists"></span> from the album <span id="album"></span>.
	<br />The player is at <span id="position"></span> and is <span id="repeat"></span> and is <span id="shuffle"></span>.
</p>

<h2>What do you want to do?</h2>

<p><strong><a href="play">playpause</a></strong> <br />
Plays current song if no song is playing, pauses if a song is currenty playing.</p>

<p><strong><a href="playURI/spotify:track:3Y2nz1ySBZ9Wg0kv9Cuc3Q">/play/uri</a></strong> <br />
Plays whatever the Spotify URI points to. Could be a song, a playlist, an album or an artist.</p>

<p><strong><a href="next">/next</a></strong> <br />
Plays next song in the play queue.</p>

<p><strong><a href="prev">/prev</a></strong> <br />
Plays previous song in the play queue.</p>

<p><strong><a href="/set/volume/50">/set/property/value</a></strong> <br />
Set a player property. Currently supported:</p>

<ul>
<li><a href="/set/state/pause">/state</a> - <em>play</em> or <em>pause</em>.</li>
<li><a href="/set/position/200">/position</a> - Number of seconds. Must be at least 0 and less than the lenght of the track.</li>
<li><a href="/set/volume/50">/volume</a> - Number of seconds. Must be between 0 and 100.</li>
</ul>

<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>
	jQuery(function($){
		var socket = io.connect(':3000/client'),
			state = $('#state'),
			isPlaying,
			name = $('#name'),
			artists = $('#artists'),
			album = $('#album'),
			position = $('#position'),
			positionValue, time,
			repeat = $('#repeat'),
			shuffle = $('#shuffle');

		socket.on('connect', function(data){
			console.log('Successfully connected as client');
		});

		socket.on('change', function(data){
			var i;
			console.log(data);

			for( i in data ){
				switch( i ){
					case 'state':
						isPlaying = data[i];
						state.html(data[i] && 'playing' || 'paused:');
						break;
					case 'track':
						name.html(data[i]);
						break;
					case 'artists':
						if( data[i].length < 3 ){
							artists.html(data[i].join(' and '));
						}
						else {
							artists.html(data[i].splice(0, data[i].length - 1).join(', ') + ' and ' + data[i][data[i].length - 1]);
						}
						break;
					case 'album':
						album.html(data[i]);
						break;
					case 'position':
						positionValue = data[i];
						time = new Date(positionValue);
						position.html(time.getMinutes() + ':' + time.getSeconds());
						break;
					case 'repeat':
						repeat.html(data[i] && 'on repeat' || 'not on repeat');
						break;
					case 'shuffle':
						shuffle.html(data[i] && 'shuffling' || 'not shuffling');
						break;
				}
			}
		});

		// Keep approximate time updated
		(function updateTime(){
			if( !isNaN(positionValue) && isPlaying ){
				positionValue += 1000;
				time = new Date(positionValue);
			}

			if( time ){
				position.html(time.getMinutes() + ':' + time.getSeconds());
			}
			setTimeout(updateTime, 1000);
		}());

		/*$('a').click(function(e){
			var params = $(this).attr('href').split('/');

			e.preventDefault();

			socket.emit('ask', {
				command: params[0],
				values: params.splice(1)
			});
		});*/
	});
</script>

</body>
</html>